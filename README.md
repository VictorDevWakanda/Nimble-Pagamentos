# üí≥ Nimble Pagamento ‚Äì API Gateway de Pagamentos

Este projeto √© uma API REST desenvolvida para simular um gateway de pagamentos simplificado, permitindo que usu√°rios realizem opera√ß√µes como cadastro, autentica√ß√£o, cria√ß√£o e gest√£o de cobran√ßas, pagamentos entre contas, dep√≥sitos e cancelamentos.

## Sum√°rio

- [Requisitos](#requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [Execu√ß√£o](#execu√ß√£o)
- [Documenta√ß√£o da API](#documenta√ß√£o-da-api)
- [Postman Collection](#postman-collection)
- [Estrutura das Entidades](#estrutura-das-entidades)
- [Regras de Neg√≥cio e Permiss√µes](#regras-de-neg√≥cio-e-permiss√µes)
- [Exemplos de Uso](#exemplos-de-uso)
- [Testes e Cobertura de C√≥digo](#testes-e-cobertura-de-c√≥digo)
- [Observa√ß√µes](#observa√ß√µes)
- [Autor](#autor)


### Funcionalidades Principais

- **üë§ Gerenciamento de Usu√°rios:** Cadastro, autentica√ß√£o JWT e controle de saldo
- **üí∞ Sistema de Cobran√ßas:** Cria√ß√£o, consulta e gest√£o de cobran√ßas entre usu√°rios
- **üí≥ Processamento de Pagamentos:** Pagamento via saldo ou cart√£o de cr√©dito
- **üîÑ Cancelamento:** Cancelamento de cobran√ßas com regras espec√≠ficas
- **üíµ Dep√≥sitos:** Adi√ß√£o de saldo via integra√ß√£o externa
- **üîê Seguran√ßa:** Rate limiting, autentica√ß√£o JWT e valida√ß√µes de neg√≥cio

## Requisitos

- [Git](https://git-scm.com/downloads)
- [Java 17](https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html)
- [Lombok](https://projectlombok.org/download)
- [Docker](https://docs.docker.com/engine/install/)
- [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
- [Postman](https://www.postman.com/downloads/) (para testar a API)

## Instala√ß√£o

### 1. Clone o reposit√≥rio:

```bash
git clone https://github.com/VictorDevWakanda/Nimble-Pagamentos.git
cd nimble-pagamento
```

### 2. Inicie os containers Docker:

```bash
docker compose up -d
```

### 3. Execute a aplica√ß√£o:

```bash
./mvnw spring-boot:run
```

## Execu√ß√£o

A aplica√ß√£o iniciar√° automaticamente com as seguintes configura√ß√µes:

- **Porta:** 8080
- **Context Path:** `/nimble-pagamento/api`
- **Database:** PostgreSQL (via Docker)
- **Documenta√ß√£o:** Swagger UI dispon√≠vel

## Documenta√ß√£o da API

### üìä Health Check
**http://localhost:8080/nimble-pagamento/api/actuator/health**

### üåê Swagger UI
Acesse a documenta√ß√£o interativa da API em:
**http://localhost:8080/nimble-pagamento/api/swagger-ui.html**

### üîó API Base URL
**http://localhost:8080/nimble-pagamento/api**

## Postman Collection

Para facilitar os testes, foi criada uma collection completa do Postman com todos os endpoints da API.

### üì• Como Usar

1. **Importe o arquivo** `nimbleCollection.json` no Postman
2. **Configure as vari√°veis de ambiente:**
   - `baseUrl`: http://localhost:8080/nimble-pagamento/api
   - `token`: Token JWT obtido ap√≥s login
   - `userId`: UUID do usu√°rio
   - `cobrancaId`: UUID da cobran√ßa

### üîê Fluxo de Uso Recomendado

#### 1. Cadastro e Login
1. Execute "Cadastrar Usu√°rio" para criar uma conta
2. Execute "Login" para obter o token JWT
3. Copie o token para a vari√°vel `{{token}}`

#### 2. Opera√ß√µes de Cobran√ßa
1. Execute "Criar Cobran√ßa" (precisa do token)
2. Use o ID da cobran√ßa retornado na vari√°vel `{{cobrancaId}}`
3. Execute "Consultar Cobran√ßa por ID"
4. Execute "Listar Cobran√ßas Criadas" ou "Listar Cobran√ßas Recebidas"

#### 3. Pagamentos
1. Execute "Pagar com Saldo" (destinat√°rio)
2. Ou execute "Pagar com Cart√£o" (destinat√°rio)

#### 4. Cancelamento
1. Execute "Cancelar Cobran√ßa" (apenas originador)

#### 5. Dep√≥sito
1. Execute "Realizar Dep√≥sito" para adicionar saldo

### üè∑Ô∏è Organiza√ß√£o da Collection

- üîê **Autentica√ß√£o** - Login e cadastro
- üë§ **Usu√°rio** - Gerenciamento completo de usu√°rios
- üí∞ **Cobran√ßa** - CRUD de cobran√ßas
- üí≥ **Pagamento** - Processamento de pagamentos
- üîÑ **Cancelamento** - Cancelamento de cobran√ßas
- üíµ **Dep√≥sito** - Adi√ß√£o de saldo
- üè• **Monitoramento** - Health checks e status

## üöÄ Endpoints Dispon√≠veis

### üîê Autentica√ß√£o
- `POST /usuario/autenticacao/login`

### üë§ Usu√°rio
- `POST /usuario` (cadastro)
- `GET /usuario/{idUsuario}` (consulta por ID)
- `PATCH /usuario/{idUsuario}` (altera√ß√£o)
- `DELETE /usuario/{idUsuario}` (exclus√£o)

### üí∞ Cobran√ßa
- `POST /cobrancas` (criar)
- `GET /cobrancas/consulta` (consultar por ID)
- `GET /cobrancas/originador` (listar do originador)
- `GET /cobrancas/destinatario` (listar do destinat√°rio)

### üí≥ Pagamento
- `POST /cobrancas/pagamento/{idCobranca}` (com saldo)
- `POST /cobrancas/pagamento-cartao/{idCobranca}` (com cart√£o)

### üîÑ Cancelamento
- `POST /cobrancas/{idCobranca}/cancelamento`

### üíµ Dep√≥sito
- `POST /cobrancas/deposito`

### üè• Monitoramento
- `GET /actuator/health` (health check)

## Estrutura das Entidades

### üë§ Usu√°rio

| Campo | Tipo | Descri√ß√£o | Valida√ß√£o |
|-------|------|-----------|-----------|
| `idUsuario` | UUID | Identificador √∫nico | Auto-gerado |
| `nome` | String | Nome completo | Obrigat√≥rio |
| `cpf` | String | CPF do usu√°rio | √önico, validado |
| `email` | String | Email do usu√°rio | √önico, validado |
| `senhaHash` | String | Senha criptografada | BCrypt |
| `saldo` | BigDecimal | Saldo da conta | ‚â• 0.00 |

### üí∞ Cobran√ßa

| Campo | Tipo | Descri√ß√£o | Valida√ß√£o |
|-------|------|-----------|-----------|
| `idCobranca` | UUID | Identificador √∫nico | Auto-gerado |
| `idUsuarioOriginador` | UUID | ID do usu√°rio que criou | Obrigat√≥rio |
| `cpfDestinatario` | String | CPF do destinat√°rio | Validado |
| `valorCobranca` | BigDecimal | Valor da cobran√ßa | > 0.00 |
| `descricao` | String | Descri√ß√£o da cobran√ßa | ‚â§ 500 chars |
| `status` | Enum | Status atual | PENDENTE/PAGA/CANCELADA |
| `formaPagamento` | Enum | Forma de pagamento | SALDO/CARTAO |
| `dataExpiracao` | LocalDateTime | Data de expira√ß√£o | Auto-definido |
| `dataPagamento` | LocalDateTime | Data do pagamento | Auto-definido |
| `dataCancelamento` | LocalDateTime | Data do cancelamento | Auto-definido |

## Regras de Neg√≥cio e Permiss√µes

### üîê Autentica√ß√£o
- Apenas usu√°rios autenticados podem acessar endpoints protegidos
- Autentica√ß√£o via CPF ou e-mail + senha
- Senhas armazenadas com BCrypt
- Tokens JWT com expira√ß√£o configur√°vel

### üí∞ Cobran√ßas
- Apenas o **originador** pode cancelar uma cobran√ßa
- Apenas o **destinat√°rio** pode pagar uma cobran√ßa
- Cobran√ßas expiram em 30 dias por padr√£o
- Valor m√≠nimo: R$ 0,01

### üí≥ Pagamentos
- **Saldo:** D√©bito direto da conta do pagador
- **Cart√£o:** Requer valida√ß√£o externa via API
- Pagamentos s√£o irrevers√≠veis (exceto cancelamentos autorizados)

### üîÑ Cancelamentos
- Apenas originador pode solicitar
- Cobran√ßas pagas com cart√£o requerem autoriza√ß√£o externa
- Cancelamentos geram estorno quando necess√°rio

### üíµ Dep√≥sitos
- Todos os dep√≥sitos passam por valida√ß√£o externa
- Saldo atualizado automaticamente
- Hist√≥rico de transa√ß√µes mantido

## Exemplos de Uso

### üîê Autentica√ß√£o

#### Login
```http
POST /usuario/autenticacao/login
Content-Type: application/json

{
  "cpfOuEmail": "12345678909",
  "senha": "senhaSegura"
}
```

#### Cadastro de Usu√°rio
```http
POST /usuario
Content-Type: application/json

{
  "nome": "Jo√£o Silva",
  "cpf": "12345678909",
  "email": "joao@email.com",
  "senha": "senhaSegura"
}
```

### üí∞ Opera√ß√µes de Cobran√ßa

#### Criar Cobran√ßa
```http
POST /cobrancas
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "cpfDestinatario": "11144477735",
  "valorCobranca": 150.00,
  "descricao": "Servi√ßo de consultoria"
}
```

#### Consultar Cobran√ßa por ID
```http
GET /cobrancas/consulta?idCobranca={{cobrancaId}}&idUsuarioSolicitante={{userId}}
Authorization: Bearer {{token}}
```

#### Listar Cobran√ßas Criadas (Originador)
```http
GET /cobrancas/originador?IdusuarioOriginador={{userId}}&status=PENDENTE
Authorization: Bearer {{token}}
```

#### Listar Cobran√ßas Recebidas (Destinat√°rio)
```http
GET /cobrancas/destinatario?idUsuarioSolicitante={{userId}}&status=PAGA
Authorization: Bearer {{token}}
```

### üí≥ Pagamentos

#### Pagamento com Saldo
```http
POST /cobrancas/pagamento/{{cobrancaId}}?idUsuarioPagador={{userId}}
Authorization: Bearer {{token}}
```

#### Pagamento com Cart√£o
```http
POST /cobrancas/pagamento-cartao/{{cobrancaId}}?idUsuarioPagador={{userId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "numeroCartao": "4111111111111111",
  "validade": "12/28",
  "cvv": "123"
}
```

### üîÑ Cancelamento

#### Cancelar Cobran√ßa
```http
POST /cobrancas/{{cobrancaId}}/cancelamento?idUsuarioSolicitante={{userId}}
Authorization: Bearer {{token}}
```

### üíµ Dep√≥sito

#### Realizar Dep√≥sito
```http
POST /cobrancas/deposito?idUsuario={{userId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "valor": 500.00
}
```

## Observa√ß√µes

- ‚úÖ **Spring Security:** Autentica√ß√£o JWT implementada
- ‚úÖ **Rate Limiting:** 5 requisi√ß√µes por minuto por IP
- ‚úÖ **Valida√ß√µes:** CPF (formato correto), email, valores positivos
- ‚úÖ **Integra√ß√µes:** WebClient para autorizador externo
- ‚úÖ **Docker:** Pronto para containeriza√ß√£o
- ‚úÖ **Clean Code:** SOLID, DDD e boas pr√°ticas
- ‚úÖ **Documenta√ß√£o:** Swagger UI atualizada
- ‚úÖ **Testes:** Testes unit√°rios e de integra√ß√£o com cobertura JaCoCo

## üìä Testes e Cobertura de C√≥digo

O projeto utiliza **JaCoCo** (Java Code Coverage) para an√°lise de cobertura de c√≥digo nos testes automatizados.

### üß™ Executando os Testes

Para executar os testes unit√°rios e de integra√ß√£o e gerar o relat√≥rio de cobertura:

```bash
mvn clean test
```

### üìà Relat√≥rio de Cobertura

Ap√≥s a execu√ß√£o dos testes, o relat√≥rio de cobertura √© gerado automaticamente e pode ser encontrado em:

**üìÅ Localiza√ß√£o:** `target/site/jacoco/index.html`

### üåê Visualizando o Relat√≥rio

1. Execute o comando `mvn clean test`
2. Abra o arquivo `target/site/jacoco/index.html` no seu navegador
3. O relat√≥rio mostra:
   - **Cobertura por classe** (linhas, branches, complexidade)
   - **Cobertura geral do projeto**
   - **Linhas n√£o cobertas** destacadas em vermelho
   - **M√©tricas detalhadas** por pacote e classe

### üéØ Configura√ß√£o do JaCoCo

O plugin JaCoCo est√° configurado no `pom.xml` com:

- **Vers√£o:** 0.8.10
- **Relat√≥rio:** Gerado automaticamente na fase `test`
- **Formato:** HTML (acess√≠vel via navegador)
- **Integra√ß√£o:** Maven (executado com `mvn test`)

### üìã Estrutura de Testes

O projeto est√° estruturado para suportar:

- ‚úÖ **Testes Unit√°rios** - Domain Services e regras de neg√≥cio
- ‚úÖ **Testes de Integra√ß√£o** - Controllers, repositories e fluxos completos
- ‚úÖ **Testes de API** - Endpoints REST
- ‚úÖ **Cobertura de C√≥digo** - An√°lise autom√°tica com JaCoCo

---

## üë®‚Äçüíª Autor

**Jo√£o Victor Mota**

- üíº [LinkedIn](https://www.linkedin.com/in/jvnmdev/)
- üìß victormota_03@hotmail.com

Sinta-se √† vontade para entrar em contato para d√∫vidas, sugest√µes ou oportunidades!

---

## üìö Links √öteis

- [üìñ Swagger UI](#documenta√ß√£o-da-api)
- [üìã Postman Collection](#postman-collection)
- [üîß Exemplos de Uso](#exemplos-de-uso)
- [üöÄ Endpoints Dispon√≠veis](#endpoints-dispon√≠veis)
- [üèóÔ∏è Estrutura das Entidades](#estrutura-das-entidades)
- [üìä Testes e Cobertura](#testes-e-cobertura-de-c√≥digo)

